ip configuration :
==================

R1 :
----

hostname PE1


int e0/0

ip add 12.1.1.1 255.255.255.0

ip ospf network point-to-point

no shutdown

exit


int lo1

ip add 1.1.1.1 255.255.255.255

exit

-------------------------------------------------------------------------------------------------------------

R2:
----

hostname PE2


int e0/0

ip add 12.1.1.2 255.255.255.0

ip ospf network point-to-point

no shutdown

exit


int e0/1

ip add 23.1.1.2 255.255.255.0

ip ospf network point-to-point

no shutdown

exit


int lo1

ip add 2.2.2.2 255.255.255.255

-------------------------------------------------------------------------------------------------------------

R3:
---

hostname PE3


int e0/0

ip add 23.1.1.3 255.255.255.0

ip ospf network point-to-point

no shutdown

exit


int e0/1

ip add 34.1.1.3 255.255.255.0

ip ospf network point-to-point

no shutdown

exit


int lo1

ip add 3.3.3.3 255.255.255.255

-------------------------------------------------------------------------------------------------------------

R4 :
-----

hostname PE4


int e0/0

ip add 34.1.1.4 255.255.255.0

ip ospf network point-to-point

no shutdown

exit


int e0/1

ip add 45.1.1.4 255.255.255.0

ip ospf network point-to-point

no shutdown

exit


int lo1

ip add 4.4.4.4 255.255.255.255

exit

-------------------------------------------------------------------------------------------------------------

R5:

hostname PE5


int e0/0

ip add 45.1.1.5 255.255.255.0

ip ospf network point-to-point

no shutdown

exit


int lo1

ip add 5.5.5.5 255.255.255.255

exit

-------------------------------------------------------------------------------------------------------------

R6 :
----

hostname HUB


int e0/0

ip add 61.1.1.6 255.255.255.0

ip ospf network point-to-point

no shutdown

exit


int lo1

ip add 60.1.1.1 255.255.255.255

exit


int lo2

ip add 60.2.1.1 255.255.255.255

exit


int lo3

ip add 60.3.1.1 255.255.255.255

exit

-------------------------------------------------------------------------------------------------------------

R7:
---

hostname SPK1


int fa0/0

ip add 27.1.1.7 255.255.255.0

ip ospf network point-to-point

no shutdown

exit


int lo1

ip add 70.1.1.1 255.255.255.255

exit

int lo2

ip add 70.2.1.1 255.255.255.255

exit

int lo3

ip add 70.3.1.1 255.255.255.255

exit

-------------------------------------------------------------------------------------------------------------

R8:
---

hostname SPK2


int fa0/0

ip add 38.1.1.8 255.255.255.0

ip ospf network point-to-point

no shutdown

exit


int lo1

ip add 80.1.1.1 255.255.255.255

exit


int lo2

ip add 80.2.1.1 255.255.255.255

exit


int lo3

ip add 80.3.1.1 255.255.255.255

exit

-------------------------------------------------------------------------------------------------------------

R9:-
----

hostname SPK3


int fa0/0

ip add 49.1.1.9 255.255.255.0

ip ospf network point-to-point

no shutdown

exit


int lo1

ip add 90.1.1.1 255.255.255.255

exit


int lo2

ip add 90.2.1.1 255.255.255.255

exit


int lo3

ip add 90.3.1.1 255.255.255.255

exit

-------------------------------------------------------------------------------------------------------------

R10 :-
-----

hostname DR


int e0/0

ip add 50.1.1.10 255.255.255.0

ip ospf network point-to-point

no shutdown

exit


int lo1

ip add 100.1.1.1 255.255.255.255

exit


int lo2

ip add 100.2.1.1 255.255.255.255

exit


int lo3

ip add 100.3.1.1 255.255.255.255

exit

===================================================================================================================================

Internal routing between PEs :

ospf :-
======

R1:
----

router ospf 100 

router-id 1.1.1.1

network 12.1.1.0 0.0.0.255 area 0 

network 1.1.1.1 255.255.255.255 area 0 

mpls ldp autoconfig area 0

exit

-------------------------------------------------------------------------------------------------------------

R2 :
-----

router ospf 100 

router-id 2.2.2.2

network 12.1.1.0 0.0.0.255 area 0 

network 23.1.1.0 0.0.0.255 area 0 

network 2.2.2.2 255.255.255.255 area 0 

mpls ldp autoconfig area 0

exit

-------------------------------------------------------------------------------------------------------------

R3 :
-----

router ospf 100 

router-id 3.3.3.3

network 23.1.1.0 0.0.0.255 area 0 

network 34.1.1.0 0.0.0.255 area 0 

network 3.3.3.3 255.255.255.255 area 0 

mpls ldp autoconfig area 0

exit

-------------------------------------------------------------------------------------------------------------

R4 :
-----

router ospf 100 

router-id 4.4.4.4

network 34.1.1.0 0.0.0.255 area 0 

network 45.1.1.0 0.0.0.255 area 0 

network 4.4.4.4 255.255.255.255 area 0 

mpls ldp autoconfig area 0

exit

-------------------------------------------------------------------------------------------------------------

R5 :
-----

router ospf 100 

router-id 5.5.5.5

network 45.1.1.0 0.0.0.255 area 0 

network 5.5.5.5 255.255.255.255 area 0 

mpls ldp autoconfig area 0

exit

=================================================================================================================

MP-BGP Configuration :-
=======================

R1 :
-----

router bgp 100

neighbor 2.2.2.2 remote-as 100

neighbor 2.2.2.2 update-source loopback1 

neighbor 3.3.3.3 remote-as 100

neighbor 3.3.3.3 update-source loopback1 

neighbor 4.4.4.4 remote-as 100

neighbor 4.4.4.4 update-source loopback1 

neighbor 5.5.5.5 remote-as 100

neighbor 5.5.5.5 update-source loopback1 

address-family vpnv4 

neighbor 2.2.2.2 activate

neighbor 3.3.3.3 activate

neighbor 4.4.4.4 activate

neighbor 5.5.5.5 activate

exit

-------------------------------------------------------------------------------------------------------------

R2 :
-----

router bgp 100

neighbor 1.1.1.1 remote-as 100

neighbor 1.1.1.1 update-source loopback1 

neighbor 5.5.5.5 remote-as 100

neighbor 5.5.5.5 update-source loopback1 

address-family vpnv4 

neighbor 1.1.1.1 activate

neighbor 5.5.5.5 activate

exit

-------------------------------------------------------------------------------------------------------------

R3 :
-----

router bgp 100

neighbor 1.1.1.1 remote-as 100

neighbor 1.1.1.1 update-source loopback1 

neighbor 5.5.5.5 remote-as 100

neighbor 5.5.5.5 update-source loopback1 

address-family vpnv4 

neighbor 1.1.1.1 activate

neighbor 5.5.5.5 activate

exit

-------------------------------------------------------------------------------------------------------------

R4 :

router bgp 100

neighbor 1.1.1.1 remote-as 100

neighbor 1.1.1.1 update-source loopback1 

neighbor 5.5.5.5 remote-as 100

neighbor 5.5.5.5 update-source loopback1 

address-family vpnv4 

neighbor 1.1.1.1 activate

neighbor 5.5.5.5 activate

exit

-------------------------------------------------------------------------------------------------------------

R5 :

router bgp 100

neighbor 1.1.1.1 remote-as 100

neighbor 1.1.1.1 update-source loopback1

neighbor 2.2.2.2 remote-as 100

neighbor 2.2.2.2 update-source loopback1 

neighbor 3.3.3.3 remote-as 100

neighbor 3.3.3.3 update-source loopback1 

neighbor 4.4.4.4 remote-as 100

neighbor 4.4.4.4 update-source loopback1 
 
address-family vpnv4 

neighbor 1.1.1.1 activate

neighbor 2.2.2.2 activate

neighbor 3.3.3.3 activate

neighbor 4.4.4.4 activate

exit

=================================================================================================================

VRF:-
====

R1 :

ip vrf HUB

RD 10:10

route-target export 100:100

route-target import 200:200
route-target import 300:300
route-target import 400:400
route-target import 500:500

int e0/1

ip vrf forwarding HUB

ip ospf network point-to-point 

ip add 61.1.1.1 255.255.255.0

-------------------------------------------------------------------------------------------------------------

R2:
-----

ip vrf SPK1

RD  10:10

route-target export 200:200

route-target import 100:100
route-target import 500:500

exit


int e0/2

ip vrf forwarding SPK1

ip ospf network point-to-point 

ip add 27.1.1.2 255.255.255.0 

exit

-------------------------------------------------------------------------------------------------------------

R3:
---

ip vrf SPK2

RD 10:10

route-target export 300:300

route-target import 100:100
route-target import 500:500

exit


int e0/2

ip vrf forwarding SPK2

ip ospf network point-to-point 

ip add 38.1.1.3 255.255.255.0 

no shut

exit

-------------------------------------------------------------------------------------------------------------

R4:
----

ip vrf SPK3

RD  10:10

route-target export 400:400

route-target import 100:100
route-target import 500:500

exit


int e0/2

ip vrf forwarding SPK3

ip ospf network point-to-point

no ip add 49.1.1.2 255.255.255.0 

ip add 49.1.1.4 255.255.255.0 

no shut

exit

-------------------------------------------------------------------------------------------------------------

R5:
---

ip vrf DR

RD 10:10

route-target export 500:500

route-target import 100:100
route-target import 200:200
route-target import 300:300
route-target import 400:400

exit


int e0/1

ip vrf forwarding DR

ip ospf network point-to-point

ip add 50.1.1.5 255.255.255.0 

no shut

exit


===========================================================================================================================================

CE TO PE OSPF :-
================


R1 :
------

router ospf 10 vrf HUB

router-id 1.1.1.10 

network 61.1.1.0 0.0.0.255 area 1

exit

-------------------------------------------------------------------------------------------------------------

R2:
-----

router ospf 10 vrf SPK1

router-id 2.2.2.10

network 27.1.1.0 0.0.0.255 area 1

exit

-------------------------------------------------------------------------------------------------------------

R3:
-----

router ospf 10 vrf SPK2

router-id 3.3.3.10

network 38.1.1.0 0.0.0.255 area 1

exit

-------------------------------------------------------------------------------------------------------------

R4:-
-----

router ospf 10 vrf SPK3

router-id 4.4.4.10

network 49.1.1.0 0.0.0.255 area 1

exit

-------------------------------------------------------------------------------------------------------------

R5:-
-----

router ospf 10 vrf DR

router-id 5.5.5.10

network 50.1.1.0 0.0.0.255 area 1

exit

-------------------------------------------------------------------------------------------------------------

R6:
----

router ospf 10 

router-id 6.6.6.6 

network 0.0.0.0 255.255.255.255 area 1 

exit

-------------------------------------------------------------------------------------------------------------

R7:
----

router ospf 10 

router-id 7.7.7.7

network 0.0.0.0 255.255.255.255 area 1 

exit

-------------------------------------------------------------------------------------------------------------

R8:
----

router ospf 10 

router-id 8.8.8.8

network 0.0.0.0 255.255.255.255 area 1 

exit

-------------------------------------------------------------------------------------------------------------

R9:
----

router ospf 10 

router-id 9.9.9.9

network 0.0.0.0 255.255.255.255 area 1 

exit

-------------------------------------------------------------------------------------------------------------

R10:
----

router ospf 10 

router-id 10.10.10.10

network 0.0.0.0 255.255.255.255 area 1 

exit

==============================================================================================================================

Redistibution :
----------------

R1:
---

router bgp 100 

address-family ipv4 vrf HUB

redistribute ospf 10

exit


router ospf 10 vrf HUB 

redistribute  bgp 100 subnets 

exit

-------------------------------------------------------------------------------------------------------------

R2:
---

router bgp 100 

address-family ipv4 vrf SPK1

redistribute ospf 10

exit


router ospf 10 vrf SPK1

redistribute  bgp 100 subnets 

exit

-------------------------------------------------------------------------------------------------------------

R3:
---

router bgp 100 

address-family ipv4 vrf SPK2

redistribute ospf 10

exit


router ospf 10 vrf SPK2

redistribute  bgp 100 subnets 

exit

-------------------------------------------------------------------------------------------------------------

R4:
---

router bgp 100 

address-family ipv4 vrf SPK3

redistribute ospf 10

exit


router ospf 10 vrf SPK3

redistribute  bgp 100 subnets 

exit

-------------------------------------------------------------------------------------------------------------

R5:
---

router bgp 100 

address-family ipv4 vrf DR

redistribute ospf 10

exit


router ospf 10 vrf DR

redistribute  bgp 100 subnets 

exit

===========================================================================================================================

Part 2 :-
=========

Backdoor link config :-
======================

R6 :
-----

int e0/1

ip add 67.1.1.6 255.255.255.0 

ip ospf cost 65535

no shut 

-------------------------------------------------------------------------------------------------------------

R10 :

int e0/1

ip add 67.1.1.10 255.255.255.0 

ip ospf cost 65535

no shut 

=======================================================================================================================

sham link :-
============

R1 :
----

int lo10

ip vrf forwarding HUB 

ip add 10.10.10.10 255.255.255.255 

exit


Router bgp 100 

address-family ipv4 unicast vrf HUB 

network 10.10.10.10 mask 255.255.255.255 

exit


router ospf 10 vrf HUB

area 1 sham-link 10.10.10.10 50.50.50.50

exit


-------------------------------------------------------------------------------------------------------------

R5:-
----

int lo10

ip vrf forwarding DR

ip add 50.50.50.50 255.255.255.255 

exit


Router bgp 100 

address-family ipv4 unicast vrf DR 

network 50.50.50.50 mask 255.255.255.255 

exit


router ospf 10 vrf DR

area 1 sham-link 50.50.50.50 10.10.10.10

exit

=======================================================================================================================================

Part -3 :-
=========

Assiging IPS :
-------------

Internet :
----------

hostname Internet 


int fa0/1

ip add 11.11.11.2 255.255.255.252

no shut 

exit 



int fa0/0

ip add 22.22.22.2 255.255.255.252

no shut 

exit 



int lo1

ip add 8.8.8.8 255.255.255.255 

exit


Static route :
---------------

ip route 1.1.1.2 255.255.255.255 11.11.11.1  ---R6
ip route 2.2.2.2 255.255.255.255 22.22.22.1  ---R10

========================================================================================================================

ISP 1 :
-------

Assiging IPS :
-------------


hostname ISP-1


int fa0/1

ip add 1.1.1.1 255.255.255.252

no shut 

exit 


int fa0/0

ip add 11.11.11.1 255.255.255.252

no shut 

exit 


Static route :
---------------

ip route 8.8.8.8 255.255.255.255 11.11.11.2

========================================================================================================================================================

ISP 2 :
-------

Assiging IPS :
-------------


hostname ISP-2


int fa0/1

ip add 2.2.2.1 255.255.255.252

no shut 

exit 


int fa0/0

ip add 22.22.22.1 255.255.255.252

no shut 

exit 


Static route :
---------------

ip route 8.8.8.8 255.255.255.255 22.22.22.2

=========================================================================================================================================================


Assiging IPS :
-------------

R6 :
-----

int e0/2

ip add 1.1.1.2 255.255.255.252 

no shut 

exit


Static route :
---------------

ip route 11.11.11.1 255.255.255.255 1.1.1.1

----------------------------------------------------------------------------------------------------------------------------------

R10 :

int e0/2

ip add 2.2.2.2 255.255.255.252 

no shut

exit


Static route :
---------------

ip route 0.0.0.0 0.0.0.0 2.2.2.1 250


================================================================================

IP SLA :
--------

ip sla 5
 icmp-echo 11.11.11.1 source-interface Ethernet0/2
 frequency 5
ip sla schedule 5 life forever start-time now


ip sla 10
 icmp-echo 61.1.1.1 source-interface Ethernet0/0
 frequency 5
ip sla schedule 10 life forever start-time now


track 10 ip sla 5 reachability
track 20 ip sla 10 reachability


track 30 list boolean or
 object 10
 object 20


Default route :
---------------

ip route 0.0.0.0 0.0.0.0 1.1.1.1 track 30

====================================================================================================================


Natting :
---------

R6 HUB :
--------

int e0/2 

ip nat outside 

exit


int e0/0

ip nat inside

exit


#access-list 10 permit any


ip nat inside source list 10 int eth 0/2 override 

----------------------------------------------------------------------------------------------------------------

Advertising default route :
---------------------------

R6 :
-----

router ospf 10 

default-information originate

exit

-----------------------------------------------------------------------------------------

R1 :
----

router bgp 100

address-family ipv4 unicast vrf HUB

redistribute ospf 10 match internal external 2

default-information originate

exit

-----------------------------------------------------------------------------------------

R2 :
----

router ospf 10 vrf SPK1

default-information originate

exit

-----------------------------------------------------------------------------------------

R3 :
----

router ospf 10 vrf SPK2

default-information originate

exit

-----------------------------------------------------------------------------------------

R4 :
----

router ospf 10 vrf SPK3

default-information originate

exit

-----------------------------------------------------------------------------------------

R5 :
----

router ospf 10 vrf DR

default-information originate

exit


=============================================================================================================================

Back up natting on DR :-
=======================


R10 DR :
--------

int e0/2 

ip nat outside 

exit


int e0/0

ip nat inside

exit


#access-list 20 permit any


ip nat inside source list 20 int eth 0/2 overload

============================================================================================

Advertising default route :
---------------------------

router ospf 10 

default-information originate

exit

---------------------------------------------------------------------------------------------------

R5 :
----

router bgp 100

address-family ipv4 unicast vrf DR

redistribute ospf 10 match internal external 2

default-information originate

exit

